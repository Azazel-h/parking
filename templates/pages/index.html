{% extends "base.html" %}

{% block head %}
    <script src="https://api-maps.yandex.ru/2.1/?apikey=89f0a1ad-a907-4cba-8bb7-010c7adea78a&suggest_apikey=a4ae1a75-bf48-4aab-b62a-c018b1469c42&lang=ru_RU"
            type="text/javascript"></script>
{% endblock %}
{% load static %}

{% block title %}
    Главная
{% endblock %}

{% block content %}

    <style>
        body, html {
            width: 100%;
            height: 100%;
        }
    </style>
    <div id="YMapsID" style="height: 100%; width: 100%;"></div>

    <script type="text/javascript">
        // Функция ymaps.ready() будет вызвана, когда
        // загрузятся все компоненты API, а также когда будет готово DOM-дерево.
        ymaps.ready(init);

        function init() {
            // Создание карты.
            var myMap = new ymaps.Map("YMapsID", {
                // Координаты центра карты.
                // Порядок по умолчанию: «широта, долгота».
                // Чтобы не определять координаты центра карты вручную,
                // воспользуйтесь инструментом Определение координат.
                center: [55.76, 37.64],
                // Уровень масштабирования. Допустимые значения:
                // от 0 (весь мир) до 19.
                zoom: 9,
                controls: ['searchControl', 'routeButtonControl', 'geolocationControl', 'fullscreenControl', 'zoomControl']
            });

            var search = myMap.controls.get('searchControl');
            search.events.add("resultselect", function (result) {
                console.log(search.getResultsArray()[result.get('index')].geometry.getCoordinates())
                console.log('request: ' + search.getRequestString());
            });

            {% for i in parking_list %}
                var parkingObj = new ymaps.Placemark([{{ i.longitude }}, {{ i.latitude }}])
                myMap.geoObjects.add(parkingObj)
            {% endfor %}
        }
    </script>


    {#    <script>#}
    {#        var myMap;#}
    {#        ymaps.ready(function () {#}
    {#            myMap = new ymaps.Map("YMapsID", {#}
    {#                center: [55.76, 37.64],#}
    {#                zoom: 9,#}
    {#                controls: ['searchControl', 'routeButtonControl', 'geolocationControl', 'fullscreenControl', 'zoomControl']#}
    {#            });#}
    {##}
    {#            var search = myMap.controls.get('searchControl');#}
    {#            search.events.add("resultselect", function (result) {#}
    {#                console.log(search.getResultsArray()[result.get('index')].geometry.getCoordinates())#}
    {#                console.log('request: ' + search.getRequestString());#}
    {#            });#}
    {##}
    {#            {% for i in sharings %}#}
    {#                var myGeoObject = new ymaps.Placemark([{{ i.crds_lot }}, {{ i.crds_lat }}],#}
    {#                    {#}
    {#                        balloonContent:#}
    {#                            {% if user.is_authenticated %}#}
    {#                                    '<div class="card">\n' +#}
    {#                                    '    <div class="card-body">\n' +#}
    {#                                    '<h6 class="card-title"><span class="text-secondary"><a href="{% url 'share_page' key=i.id %}"> {{ i.address }} </a></h6>\n' +#}
    {#                                    {% if i.free_pbs <= 0 or session_notification %}#}
    {#                                        '    <h4 class="card-title"><span class="text-secondary"> Недоступно </h4>\n' +#}
    {#                                    {% endif %}#}
    {#                                    {% if i.free_pbs > 0 and not session_notification %}#}
    {#                                        '        <a href="{% url 'ordering' key=i.id %}" class="btn btn-primary mb-1 btn-lg btn-block"> Получить Powerbank </a>\n'#}
    {#                                        +#}
    {#                                    {% endif %}#}
    {#                                    {% if user.is_superuser %}#}
    {#                                        '        <a href="#" class="btn btn-warning mb-1 btn-sm btn-block"> Изменить точку </a>\n'#}
    {#                                        +#}
    {#                                    {% endif %}#}
    {#                                    '</div>\n' +#}
    {#                                    '</div>'#}
    {#                            {% else %}#}
    {#                                '<div class="card">\n' +#}
    {#                                        '    <div class="card-body">\n' +#}
    {#                                    '        <h4 class="card-title"> Вам нужно сначала войти на сайт! </h4>\n' +#}
    {#                                    '        <a href="{% url 'login' %}" class="btn btn-primary"> Войти </a>\n' +#}
    {#                                    '    </div>\n' +#}
    {#                                    '</div>'#}
    {#                            {% endif %}#}
    {#                    }, {#}
    {#                        iconLayout: 'default#image',#}
    {#                        {% load static %}#}
    {#                        {% if i.free_pbs > 0 and not session_notification %}#}
    {#                            iconImageHref: '<i class="bi-alarm"></i>#}
    {#                        {% else %}#}
    {#                            iconImageHref: '<i class="bi-alarm"></i>'#}
    {#                        {% endif %}#}
    {#                    });#}
    {#                myMap.geoObjects.add(myGeoObject);#}
    {#            {% endfor %}#}
    {#        });#}
    {#    </script>#}

{% endblock %}